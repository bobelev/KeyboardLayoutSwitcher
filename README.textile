h1. Keyboard Layout Switcher

h2. Что это такое

p. Keyboard Layout Switcher (KLS) — плагин для Vim, который освобождает пользователя от лишних телодвижений. 

h3. Что он делает

p. Переключает клавиатурную раскладку на раскладку по умолчанию:
* При запуске Vim;
* При выходе из режима ввода;
* Во время входа в командный режим;
* При двойном нажатии <Esc> в нормальном и командном режимах.
p. И самое вкусное:
* Запоминает раскладку, если фокус был потерян, и восстанавливает её при возврате фокуса.
p. Представьте, что вы редактируете исходный код в Vim. В какой-то момент вы отвлекаетесь, например, чтобы написать в "Твиттер":http://twitter.com/. Когда вы вернётесь в Vim, KLS автоматически восстановит раскладку. Это невероятно удобно.
p. При этом каждый таб имеет помнит свою раскладку.

h3. Раскладка по умолчанию

p. Обычно это английская раскладка США (U.S.), однако, KLS позволяет использовать иные раскладки, например, "типографскую раскладку Ильи Бирмана":http://ilyabirman.ru/typography-layout/.

h2. Как это работает

p. Непосредственно переключением раскладки занимается вспомогательное приложение, написанное на Objective-C. Запущенное без входных параметров оно печатает номер текущей раскладки (например, английская раскладка США обычно имеет номер 0). Чтобы переключиться на определённую раскладку, необходимо запустить приложение, передав ей в качестве параметра нужный номер. Если раскладки с переданным номером нет, то приложение напечатает -1.
p. Логикой занимается Vim-плагин. Он обеспечивает весь функционал, используя вспомогательное приложение. Я постарался максимально подробно комментировать исходный код плагина, чтобы любой мог разобраться.

h2. Настройка

p. Как уже говорилось выше, из коробки в качестве раскладки по умолчанию используется английская раскладка США, потому в обычном случае настройка не требуется.
p. Если вы всё же хотите использовать другую раскладку, то отредактируйте файл плагина (~/.vim/plugin/KeyboardLayoutSwitcher.vim), изменив строчку:
@let g:defaultInputSourceIndex = 2@
p. на:
@let g:defaultInputSourceIndex = n " Где n — номер нужной вам раскладки.@

h2. Совместимость

p. KLS работает только в Mac OS X 10.6 и выше. Если вы всё ещё используете 10.5, то вы можете перекомпилировать исходный код вспомогательного приложения самостоятельно.
